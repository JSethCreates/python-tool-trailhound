
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TrailHound v3.0</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
        input[type="text"] { padding: 8px; margin-right: 5px; }
        button { padding: 8px 12px; margin-left: 10px; }
        #top-controls, #search-controls { margin-bottom: 20px; }
        #folderList { width: 500px; height: 300px; background: #fff; border: 1px solid #ccc; overflow-y: auto; padding: 10px; }
        #results { display: flex; flex-wrap: nowrap; overflow-x: auto; gap: 20px; }
        .result { flex: 0 0 500px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
        iframe { display: block; margin-top: 10px; width: 100%; height: 280px; }
        .controls { margin-top: 10px; display: flex; flex-direction: column; gap: 6px; }
        .folder-item { cursor: pointer; padding: 5px; }
        .folder-item:hover, .folder-item.active { background-color: #ddd; font-weight: bold; }
    </style>
</head>
<body>
    <div id="top-controls">
        <input type="text" id="folderInput" placeholder="Enter media directory path" size="60">
        <button onclick="browseAndScan()">Browse...</button>
        <div id="folderList"><em>Folder list will appear here after scanning.</em></div>
    </div>

    <div id="search-controls">
        <h2>YouTube Search</h2>
        <input type="text" id="searchInput" placeholder="Search YouTube..." size="40">
        <button onclick="performSearch()">Search</button>
    </div>

    <div id="results"></div>

    <script>
        let selectedFolder = null;

        document.getElementById('searchInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') performSearch();
        });

        async function browseAndScan() {
            const path = await window.pywebview.api.select_folder();
            if (path && path.length > 0) {
                document.getElementById('folderInput').value = path[0];
                scanFolders(path[0]);
            }
        }

        async function scanFolders(path) {
            const list = await window.pywebview.api.scan(path);
            const folderList = document.getElementById('folderList');
            folderList.innerHTML = '';
            if (list.error) {
                folderList.innerHTML = `<p>${list.error}</p>`;
                return;
            }
            list.forEach(folder => {
                const item = document.createElement('div');
                item.className = 'folder-item';
                item.textContent = `${folder.found ? '✅' : '❌'} ${folder.name}`;
                item.onclick = async () => {
                    selectedFolder = folder.name;
                    await window.pywebview.api.set_foldername(folder.name);
                    document.getElementById('searchInput').value = `${folder.name} trailer`;
                    performSearch();
                    document.querySelectorAll('.folder-item').forEach(f => f.classList.remove('active'));
                    item.classList.add('active');
                };
                folderList.appendChild(item);
            });
        }

        async function performSearch() {
            const query = document.getElementById('searchInput').value;
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Loading...</p>';

            const results = await window.pywebview.api.search(query);
            resultsDiv.innerHTML = '';

            if (!results || results.error) {
                resultsDiv.innerHTML = `<p>Error: ${results.error}</p>`;
                return;
            }

            results.forEach(video => {
                const container = document.createElement('div');
                container.className = 'result';

                const title = document.createElement('h3');
                title.textContent = video.title;

                const iframe = document.createElement('iframe');
                iframe.src = video.embed;
                iframe.frameBorder = '0';
                iframe.allowFullscreen = true;

                const controls = document.createElement('div');
                controls.className = 'controls';

                controls.innerHTML = `
                    <strong>Resolution:</strong> ${video.resolution || 'Unknown'}<br>
                    <label>Start: <input type="text" value="0:00" class="startTime" size="5"></label>
                    <label>End: <input type="text" value="${video.duration}" class="endTime" size="5"></label>
                    <button class="downloadBtn">Download</button>
                `;

                container.appendChild(title);
                container.appendChild(iframe);
                container.appendChild(controls);
                resultsDiv.appendChild(container);

                const btn = controls.querySelector('.downloadBtn');
                btn.onclick = async () => {
                    const start = controls.querySelector('.startTime').value || null;
                    const end = controls.querySelector('.endTime').value || null;
                    btn.textContent = 'Downloading...';
                    btn.disabled = true;
                    const msg = await window.pywebview.api.download(video.url, start, end);
                    btn.textContent = msg.includes('complete') ? '✔ Complete' : '✖ Failed';
                };
            });
        }
    </script>
</body>
</html>
